![](https://academy.hackthebox.com/storage/modules/158/11.png)
```shell-session
AhmaDb0x@htb[/htb]$ nmap -sT -p22,3306 10.129.202.64

Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-24 12:12 EST
Nmap scan report for 10.129.202.64
Host is up (0.12s latency).

PORT     STATE  SERVICE
22/tcp   open   ssh
3306/tcp closed mysql
```

#### Executing the Local Port Forward

Dynamic Port Forwarding with SSH and SOCKS Tunneling

```shell-session
AhmaDb0x@htb[/htb]$ ssh -L 1234:localhost:3306 ubuntu@10.129.202.64

- Listen on **port 1234** on my local machine."
- "Forward any traffic received here to **localhost:3306** on the remote victim machine."


```
- **"Local" refers to the Attack Machine** (your machine).
- You **bind a local port (e.g., 1234)** to an SSH tunnel.
- Any traffic sent to this local port is **forwarded to the remote server’s specified port (e.g., 3306)**.
- The SSH connection acts as a secure bridge between your local machine and the remote service.
---
#### Confirming Port Forward with Netstat and nmap
```shell-session
AhmaDb0x@htb[/htb]$ netstat -antp | grep 1234
```
```shell-session
AhmaDb0x@htb[/htb]$ nmap -v -sV -p1234 localhost
```

#### Forwarding Multiple Ports
```shell-session
AhmaDb0x@htb[/htb]$ ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
```

# Setting up to Pivot


`Socket Secure`, a protocol that helps communicate with servers where you have firewall restrictions in place. Unlike most cases where you would initiate a connection to connect to a service, in the case of SOCKS, the initial traffic is generated by a SOCKS client, which connects to the SOCKS server controlled by the user who wants to access a service on the client-side. Once the connection is established, network traffic can be routed through the SOCKS server on behalf of the connected client.

---
using SOCKS proxy for pivoting and forwarding data is that SOCKS proxies can pivot via creating a route to an external server from `NAT networks`. SOCKS proxies are currently of two types: `SOCKS4` and `SOCKS5`. SOCKS4 doesn't provide any authentication and UDP support, whereas SOCKS5 does provide that.


![](https://academy.hackthebox.com/storage/modules/158/22.png)

`localhost:9050`. Whatever data you send here will be broadcasted to the entire network (172.16.5.0/23) over SSH.

#### Enabling Dynamic Port Forwarding with SSH
```shell-session
AhmaDb0x@htb[/htb]$ ssh -D 9050 ubuntu@10.129.202.64
```
`-D 9050` → Creates a **SOCKS proxy** on the Attack Host.
All traffic sent through `9050` will be **proxied via SSH** to the Victim Server.

#### Checking /etc/proxychains.conf
```shell-session
AhmaDb0x@htb[/htb]$ tail -4 /etc/proxychains.conf

socks5 127.0.0.1 9050

# defaults set to "tor"
```

it will route all the packets of Nmap to the local port 9050, where our SSH client is listening.

```shell-session
AhmaDb0x@htb[/htb]$ proxychains nmap -v -sn 172.16.5.1-200
ping sweep

`proxychains` → Routes traffic through the **SOCKS5 proxy on `127.0.0.1:9050`**.
```

We also need to make sure we are aware of the fact that `host-alive` checks may not work against Windows targets because the Windows Defender firewall blocks ICMP requests (traditional pings) by default.

```bash
ssh -D 9050 user@10.129.15.50

```

---
- All traffic **routed through this proxy** will be sent via `10.129.15.50`, which acts as a pivot into the **internal network**.
- **This allows scanning of internal machines via `proxychains`**.

---
```bash
proxychains mysql -h 172.16.5.100 -u root -p

```

---

#### Using xfreerdp with Proxychains
```shell-session
AhmaDb0x@htb[/htb]$ proxychains xfreerdp /v:172.16.5.129 /u:victor /p:pass@123
```

172.16.5.129
