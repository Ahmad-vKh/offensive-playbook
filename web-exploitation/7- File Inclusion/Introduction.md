back-end languages, such as `PHP`, `Javascript`, or `Java`, use HTTP parameters to specify what is shown on the web page, which allows for building dynamic web pages, reduces the script's overall size, and simplifies the code. In such cases, parameters are used to specify which resource is shown on the page. If such functionalities are not securely coded, an attacker may manipulate these parameters to display the content of any local file on the hosting server,

## Local File Inclusion (LFI)

LFI vulnerabilities can lead to source code disclosure, sensitive data exposure, and even remote code execution under certain conditions.

Leaking source code may allow attackers to test the code for other vulnerabilities, which may reveal previously unknown vulnerabilities

leak credentials and keys that may allow them to access the remote server directly.

LFI may also allow attackers to execute code on the remote server

---
**templating engine** is a tool that helps developers generate **dynamic HTML** pages by separating **presentation (HTML/CSS)** from **logic (backend code like PHP, Python, or JavaScript)**

>Instead of writing repetitive HTML, developers use **template files** with placeholders (variables) that get replaced with actual data at runtime.

eg:
**Template File (`index.html`)**
```html
<html>
    <body>
        <h1>Welcome, {{ username }}!</h1>
    </body>
</html
```

>templating engine displays a page that shows the common static parts, such as the `header`, `navigation bar`, and `footer`, and then dynamically loads other content that changes between pages

This is why we often see a parameter like `/index.php?page=about`, where `index.php` sets static content (e.g. header/footer), and then only pulls the dynamic content specified in the parameter, which in this case may be read from a file called `about.php`

## Examples of Vulnerable Code

`?language` GET parameter,
>different `language` parameter (e.g. `?language=es`). In such cases, changing the language may change the directory the web application is loading the pages from (e.g. `/en/` or `/es/`). If we have control over the path being loaded, then we may be able to exploit this vulnerability to read other files and potentially reach remote code execution.

#### PHP
>`PHP`, we may use the `include()` function to load a local or a remote file as we load a page. If the `path` passed to the `include()` is taken from a user-controlled parameter, like a `GET` parameter, and `the code does not explicitly filter and sanitize the user input`, then the code becomes vulnerable to File Inclusion

```php
if (isset($_GET['language'])) {
    include($_GET['language']);
}
```
`language` parameter is directly passed to the `include()` function


many other PHP functions that would lead to the same vulnerability if we had control over the path passed into them:
`include_once()`, `require()`, `require_once()`, `file_get_contents()`

>we will mostly focus on PHP web applications running on a Linux back-end server. However, most techniques and attacks would work on the majority of other frameworks, so our examples would be the same with a web application written in any other language.

#### NodeJS
GET parameter `language`
```javascript
if(req.query.language) {
    fs.readFile(path.join(__dirname, req.query.language), function (err, data) {
        res.write(data);
    });
}
```

---

`render()` function in the `Express.js` framework. The following example shows how the `language` parameter is used to determine which directory to pull the `about.html` page from
```js
app.get("/about/:language", function(req, res) {
    res.render(`/${req.params.language}/about.html`);
});
```
Unlike our earlier examples where GET parameters were specified after a (`?`) character in the URL, the above example takes the parameter from the URL path (e.g. `/about/en` or `/about/es`). As the parameter is directly used within the `render()` function to specify the rendered file, we can change the URL to show a different file instead.

---


#### Java
```jsp
<c:if test="${not empty param.language}">
    <jsp:include file="<%= request.getParameter('language') %>" />
</c:if>
```

```jsp
<c:import url= "<%= request.getParameter('language') %>"/>
```

#### .NET
The `Response.WriteFile` function works very similarly to all of our earlier examples, as it takes a file path for its input and writes its content to the response.
```cs
@if (!string.IsNullOrEmpty(HttpContext.Request.Query['language'])) {
    <% Response.WriteFile("<% HttpContext.Request.Query['language'] %>"); %> 
}
```

```cs
@Html.Partial(HttpContext.Request.Query['language'])
```
the `include` function may be used to render local files or remote URLs, and may also execute the specified files as well
```cs
<!--#include file="<% HttpContext.Request.Query['language'] %>"-->
```


## Read vs Execute
**`some of the above functions only read the content of the specified files, while others also execute the specified files`.**

The following table shows which functions may execute files and which only read file content:

|**Function**|**Read Content**|**Execute**|**Remote URL**|
|---|:-:|:-:|:-:|
|**PHP**||||
|`include()`/`include_once()`|✅|✅|✅|
|`require()`/`require_once()`|✅|✅|❌|
|`file_get_contents()`|✅|❌|✅|
|`fopen()`/`file()`|✅|❌|❌|
|**NodeJS**||||
|`fs.readFile()`|✅|❌|❌|
|`fs.sendFile()`|✅|❌|❌|
|`res.render()`|✅|✅|❌|
|**Java**||||
|`include`|✅|❌|❌|
|`import`|✅|✅|✅|
|**.NET**||||
|`@Html.Partial()`|✅|❌|❌|
|`@Html.RemotePartial()`|✅|❌|✅|
|`Response.WriteFile()`|✅|❌|❌|
|`include`|✅|✅|✅|

and the source code may also contain database keys, admin credentials, or other sensitive information.

