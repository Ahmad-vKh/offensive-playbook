#  Web Proxy

We can download ZAP from its [download page](https://www.zaproxy.org/download/),

1. SQL injections
2. Command injections
3. Upload bypass
4. Authentication bypass
5. XSS
6. XXE
7. Error handling
8. Deserialization

let us change the `ip` parameter's value from `1` to `;ls;` and see how the web application handles our input.


# Intercepting Responses

we may need to intercept the HTTP responses from the server before they reach the browser.

In our previous exercise, the `IP` field only allowed us to input numeric values. If we intercept the response before it reaches our browser, we can edit it to accept any value, which would enable us to input the payload we used last time directly.

enable response interception by going to (`Proxy>Options`) and enabling `Intercept Response` under `Intercept Server Responses`:![Burp Enable Response Int](https://academy.hackthebox.com/storage/modules/110/response_interception_enable.jpg)


After that, we can enable request interception once more and refresh the page with [`CTRL+SHIFT+R`] in our browser (to force a full refresh). When we go back to Burp, we should see the intercepted request, and we can click on `forward`
```html
<input type="text" id="ip" name="ip" min="1" max="255" maxlength="100"
    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
    required>
```
As we can see, we could change the way the page is rendered by the browser and can now input any value we want. We may use the same technique to persistently enable any disabled HTML buttons by modifying their HTML code.

Exercise: Try using the payload we used last time directly within the browser, to test how intercepting responses can make web application penetration testing easier.

----
# Automatic Modification
We may want to apply certain modifications to all outgoing HTTP requests or all incoming HTTP responses in certain situations. In these cases, we can utilize automatic modifications based on rules we set, so the web proxy tools will automatically apply them.

## Request Modification
#### Burp Match and Replace

We can go to (`Proxy>Options>Match and Replace`) and click on `Add` in Burp. As the below screenshot shows, we will set the following options:
![Burp Match Replace](https://academy.hackthebox.com/storage/modules/110/burp_match_replace_user_agent_1.jpg)

|                                               |                                                                                                                                                  |
| --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Type`: `Request header`                      | Since the change we want to make will be in the request header and not in its body.                                                              |
| `Match`: `^User-Agent.*$`                     | The regex pattern that matches the entire line with `User-Agent` in it.                                                                          |
| `Replace`: `User-Agent: HackTheBox Agent 1.0` | This is the value that will replace the line we matched above.                                                                                   |
| `Regex match`: True                           | We don't know the exact User-Agent string we want to replace, so we'll use regex to match any value that matches the pattern we specified above. |

### **What is a User-Agent?**
A **User-Agent** is a string sent by a web browser, application, or script in the **HTTP request header** to identify itself to a web server. It usually contains details about the browser, operating system, and sometimes the device type.

- Some web applications serve **different content** based on the User-Agent.
    
- Example: A mobile User-Agent might get different responses than a desktop one.

- Some websites only allow access from specific User-Agents (e.g., a custom API or a specific browser).
    
- Example: Mimicking a **Googlebot** User-Agent might trick the server into serving privileged data.

`ping=.*$`
**`ping=.*$`**

---

## Response Modification
(`Proxy>Options>Match and Replace`)
`Response body`
![Burp Match Replace](https://academy.hackthebox.com/storage/modules/110/burp_match_replace_response_1.jpg)


[`CTRL+SHIFT+R`] for refresh

# Encoding/Decoding
As we modify and send custom HTTP requests, we may have to perform various types of encoding and decoding to interact with the webserver properl


## URL Encoding

It is essential to ensure that our request data is URL-encoded and our request headers are correctly set. Otherwise, we may get a server error in the response. This is why encoding and decoding data becomes essential as we modify and repeat web requests. Some of the key characters we need to encode are:

- `Spaces`: May indicate the end of request data if not encoded
- `&`: Otherwise interpreted as a parameter delimiter
- `#`: Otherwise interpreted as a fragment identifie

>select that text and right-click on it, then select (`Convert Selection>URL>URL encode key characters`), or by selecting the text and clicking [`CTRL+U`]

## Decoding
While URL-encoding is key to HTTP requests, it is not the only type of encoding we will encounter. It is very common for web applications to encode their data, so we should be able to quickly decode that data to examine the original text

back-end servers may expect data to be encoded in a particular format or with a specific encoder, so we need to be able to quickly encode our data before we send it.

- HTML
- Unicode
- Base64
- ASCII hex

To access the full encoder in Burp, we can go to the `Decoder` tab. In ZAP, we can use the `Encoder/Decoder/Hash` by clicking [`CTRL+E`]. With these encoders, we can input any text and have it quickly encoded or decoded. For example, perhaps we came across the following cookie that is base64 encoded, and we need to decode it: `eyJ1c2VybmFtZSI6Imd1ZXN0IiwgImlzX2FkbWluIjpmYWxzZX0=`

We can input the above string in Burp Decoder and select `Decode as > Base64`

![Burp B64 Decode](https://academy.hackthebox.com/storage/modules/110/burp_b64_decode.jpg)

![Burp Inspector](https://academy.hackthebox.com/storage/modules/110/burp_inspector.jpg)

----
# Proxying Tools
## Proxychains
which routes all traffic coming from any command-line tool to any proxy we specify. `Proxychains` adds a proxy to any command-line tool and is hence the simplest and easiest method to route web traffic of command-line tools through our web proxies.

`/etc/proxychains.conf`
```bash
#socks4         127.0.0.1 9050
http 127.0.0.1 8080
```

---

