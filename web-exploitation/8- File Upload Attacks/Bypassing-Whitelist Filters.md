
Discovery/Web-Content/web-extensions.txt


A whitelist is generally more secure than a blacklist. The web server would only allow the specified extensions,

more common in web apps than seeing a blocked extension type. However, error messages do not always reflect which form of validation

use burp > sniper > all variations of PHP extensions are blocked (e.g. `php5`, `php7`, `phtml`) this mean that white valid

```php
$fileName = basename($_FILES["uploadFile"]["name"]);

if (!preg_match('^.*\.(jpg|jpeg|png|gif)', $fileName)) {
    echo "Only images are allowed";
    die();
}
```



## Double Extensions

The code only tests whether the file name contains an image extension.

`shell.jpg.php` > will pass


![[fapoxi2x.png]]

>However, this may not always work, as some web applications may use a strict `regex` pattern

## Reverse Double Extension

the file upload functionality itself may not be vulnerable ?
but the web server configuration may lead to a vulnerability

example:
the `/etc/apache2/mods-enabled/php7.4.conf` for the `Apache2` web server
```xml
<FilesMatch ".+\.ph(ar|p|tml)">
    SetHandler application/x-httpd-php
</FilesMatch>
```
if (`$`) this mean it check the last parameter

>The web application may still utilize a blacklist to deny requests containing `PHP` extensions. Try to fuzz the upload form with the [PHP Wordlist](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst) to find what extensions are blacklisted by the upload form.


## Character Injection
cause the web application to misinterpret the filename and execute the uploaded file as a PHP scrip

The following are some of the characters we may try injecting:

- `%20`
- `%0a`
- `%00`
- `%0d0a`
- `/`
- `.\`
- `.`
- `…`
- `:`

>`shell.php%00.jpg`) works with PHP servers with version `5.X` or earlier >>>> store it as (`shell.php`)


>web applications hosted on a Windows server by injecting a colon (`:`) before the allowed file extension (e.g. `shell.aspx:.jpg`)>>>>>>>(`shell.aspx`)



```bash
for char in '%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' '…' ':'; do
    for ext in '.php' '.phps'; do
        echo "shell$char$ext.jpg" >> wordlist.txt
        echo "shell$ext$char.jpg" >> wordlist.txt
        echo "shell.jpg$char$ext" >> wordlist.txt
        echo "shell.jpg$ext$char" >> wordlist.txt
    done
done
```

Try to add more PHP extensions to the above script to generate more filename permutations, then fuzz the upload functionality with the generated wordlist

![[ty4nrtc7.png]]

HTB{1_wh173l157_my53lf}
